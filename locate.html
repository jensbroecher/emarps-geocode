<!doctype html>
<html>
<head>
<meta charset="utf-8">

<meta name="viewport" content="initial-scale=1, maximum-scale=1">

<link href="main.css" rel="stylesheet" type="text/css">
<link href="animate.min.css" rel="stylesheet" type="text/css">

<script src="jquery.min.js"></script>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="cdv-plugin-parse.js"></script>

<script>

function onDeviceReady() {}

$( document ).ready(function() {

// alert('App loaded');
	
$( "#getkptypes" ).load( "http://enunua.com/emarps/database/getkptypes_geocode_app.php", function() {
//  alert( "KP Types loaded" );
hideindicator();
});

parsePlugin.initialize('len2LWLxsk86rc83UuSoeeP3uGIJ9tU89o49cGIt','b6ut6CMfUVZWGKkyxe341gq0xe7eR9OK79ZJak7Z', function() {

    parsePlugin.subscribe('GPS', function() {

        parsePlugin.getInstallationId(function(id) {

        }, function(e) {
            alert('error');
        });

    }, function(e) {
        alert('error');
    });

}, function(e) {
    alert('error');
});

});

function lpush() {
window.plugin.notification.local.add({
    id:         1,
    message:    'The location of this facility has been sent to the database',
    title:      'Location reported',
    autoCancel: true,
    ongoing:    false
});
}

function showindicator() {
	document.getElementById("loadingindicator").className = "animated fadeIn";
document.getElementById("loadingindicator").style.display = "block";
}

function hideindicator() {
	document.getElementById("loadingindicator").className = "animated fadeOut";
setTimeout(function(){
document.getElementById("loadingindicator").style.display = "none";
}, 1000);
}

function geoFindMe() {

showindicator();
	
  var output = document.getElementById("out");

  if (!navigator.geolocation){
    output.innerHTML = "<p>Geolocation is not supported by your browser</p>";
	hideindicator();
    return;
  }

  function success(position) {
    var latitude  = position.coords.latitude;
    var longitude = position.coords.longitude;
	
	hideindicator();

    output.innerHTML = '<p>Latitude is ' + latitude + '° <br>Longitude is ' + longitude + '°</p>';
	
	// alert(latitude);
	// alert(longitude);

    var img = new Image();
    img.src = "https://maps.googleapis.com/maps/api/staticmap?center=" + latitude + "," + longitude + "&zoom=13&size=400x400&sensor=false";
	img.className = "map";

    output.appendChild(img);
	
	document.getElementById('geofindbutton').style.display = "none";
	document.getElementById('detailsfordbbutton').style.display = "block";
	document.getElementById('locateagainbutton').style.display = "block";
	
	
  };

  function error() {
    output.innerHTML = "Unable to retrieve your location";
	hideindicator();
  };

  output.innerHTML = "<p>Locating…</p>";

  navigator.geolocation.getCurrentPosition(success, error);
}

function detailsfordb() {
	document.getElementById('detailsfordb').style.display = "block";
}
function sendtodb() {
	var $myForm = $('#detailsfordbform')
	if (!$myForm[0].checkValidity()) {
    $myForm.find('#sendtodb').click();
	}
}
function ajaxform() {
	alert('Data sent to server');
	lpush();
}

</script>

<div id="loadingindicator">
<img src="282.gif" width="50">
</div>

<div id="detailsfordb" style="display:non;" class="animated zoomIn">
<form id="detailsfordbform" action="javascript:ajaxform();">
<input class="textfield" placeholder="Facility Name" name="facilityname" required type="text"></input>
<input class="textfield" placeholder="Partner Name" name="partnername" required type="text"></input>
<input class="textfield" placeholder="County" name="county" required type="text"></input>
<h1>Primary KP Types:</h1>
<div id="getkptypes"></div>


<button id="sendtodb" onclick="sendtodb();">Report to database</button></form>
</div>

<button id="geofindbutton" onclick="geoFindMe()"><img align="absmiddle" src="locatemematerialdesign.png" width="40"> Find my location</button>

<button id="detailsfordbbutton" onclick="detailsfordb();" style="display:none">Report location to database</button>

<button id="locateagainbutton" onclick="document.location.reload();" style="display:none">Locate again</button>

<div id="out"></div>

</body>
</html>